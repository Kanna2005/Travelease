<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Travelease - Chat</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    /* Reset + font */
    * {margin:0;padding:0;box-sizing:border-box;font-family:'Inter',sans-serif;}
    html, body { height: 100%; }
    body.chat-page {
      display: flex;
      height: 100dvh;          /* keeps whole app within viewport */
      background: #f5f7fa;
      color: #333;
    }

    /* Sidebar */
    .sidebar {
      width: 280px;
      background: #1f2937;
      color: #fff;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
    }
    .sidebar-header {
      padding: 1rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
      border-bottom: 1px solid rgba(255,255,255,0.2);
    }
    .sidebar-header button {
      background: #374151;
      border: none;
      color: #fff;
      padding: 0.5rem 0.8rem;
      border-radius: 8px;
      cursor: pointer;
      font-size: 0.9rem;
    }
    .chat-history {
      padding: 1rem;
      overflow-y: auto;
      flex: 1;
      min-height: 0; /* allow internal scroll */
    }
    .chat-history h3 {
      margin-bottom: 0.5rem; 
      font-weight: 500; 
      font-size: 1rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .filter-controls {
      margin-bottom: 10px;
      display: flex;
      gap: 5px;
    }
    .filter-controls select {
      flex: 1;
      padding: 5px;
      border-radius: 4px;
      background: #374151;
      color: white;
      border: none;
    }
    .chat-history ul {list-style: none;}
    .chat-history li {
      padding: 0.6rem;
      border-radius: 8px;
      margin-bottom: 0.4rem;
      cursor: pointer;
      background: rgba(255,255,255,0.1);
      transition: background 0.2s;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .chat-history li:hover {background: rgba(255,255,255,0.2);}
    .chat-item-content {
      flex: 1;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }
    .delete-chat-btn {
      background: transparent;
      border: none;
      color: rgba(255, 255, 255, 0.6);
      cursor: pointer;
      padding: 2px 5px;
      border-radius: 4px;
      font-size: 0.8rem;
      display: none;
    }
    .chat-history li:hover .delete-chat-btn {
      display: block;
    }
    .delete-chat-btn:hover {
      color: #ef4444;
      background: rgba(255, 255, 255, 0.1);
    }
    .sidebar-footer {
      padding: 1rem;
      border-top: 1px solid rgba(255,255,255,0.2);
    }
    .sidebar-footer button {
      width: 100%;
      background: #ef4444;
      border: none;
      color: #fff;
      padding: 0.7rem;
      border-radius: 8px;
      cursor: pointer;
    }

    /* Main Chat Area */
    .main-chat-area {
      flex: 1;
      display: flex;
      flex-direction: column;
      min-height: 0; /* critical: lets child (#chat-container) shrink */
    }

    .chat-header {
      background: #2563eb;
      color: #fff;
      padding: 1rem 1.5rem;
      border-bottom: 2px solid #1e40af;
    }
    .chat-header h1 { font-size: 1.4rem; font-weight: 600; }
    .chat-header p { font-size: 0.9rem; opacity: 0.9; }

    .chat-container {
      flex: 1;
      display: flex;
      flex-direction: column;
      padding: 1rem;
      gap: 0.75rem;
      min-height: 0; /* critical: lets .chat-messages own the scroll */
    }

    .chat-messages {
      flex: 1;
      overflow-y: auto;        /* scroll happens here, page height stays fixed */
      padding-right: 0.5rem;
      scroll-behavior: smooth; /* nice feel when we auto-scroll */
      min-height: 0;           /* ensure no flex min-height blocking */
    }

    .message {
      max-width: 70%;
      margin-bottom: 1rem;
      padding: 0.8rem 1rem;
      border-radius: 12px;
      line-height: 1.4;
      font-size: 0.95rem;
      word-wrap: break-word;
      white-space: pre-wrap;
    }
    .message.user {
      margin-left: auto;
      background: #2563eb;
      color: #fff;
      border-bottom-right-radius: 4px;
    }
    .message.bot {
      background: #e5e7eb;
      color: #111;
      border-bottom-left-radius: 4px;
    }

    /* Input */
    .chat-input-container {
      border-top: 1px solid #ddd;
      padding: 0.8rem 1rem;
      background: #fff;
    }
    .input-wrapper {
      display: flex;
      align-items: center;
      background: #f3f4f6;
      border-radius: 25px;
      padding: 0.4rem 0.8rem;
    }
    .input-wrapper input {
      flex: 1;
      border: none;
      background: transparent;
      outline: none;
      padding: 0.6rem;
      font-size: 1rem;
    }
    .input-wrapper button {
      background: #2563eb;
      border: none;
      color: #fff;
      padding: 0.6rem 0.9rem;
      border-radius: 50%;
      cursor: pointer;
      font-size: 1rem;
    }
    .disclaimer {
      margin-top: 0.4rem;
      font-size: 0.75rem;
      color: #6b7280;
      text-align: center;
    }

    /* Optional: show a small "new" pill when user scrolls up */
    .new-pill {
      position: absolute;
      right: 1.25rem;
      bottom: 5.5rem; /* above input bar */
      padding: 0.35rem 0.6rem;
      background: #111827;
      color: #fff;
      border-radius: 999px;
      font-size: 0.8rem;
      display: none;
      cursor: pointer;
      user-select: none;
    }

    @media(max-width:768px){
      .sidebar {display:none;}
    }

    /* Ensure the messages section can position the pill */
    .chat-container { position: relative; }
  </style>
</head>
<body class="chat-page">
  <div class="sidebar">
    <div class="sidebar-header">
      <button class="back-btn" onclick="goBack()">
        <i class="fas fa-arrow-left"></i>
      </button>
      <button class="new-chat-btn" onclick="startNewChat()">
        <i class="fas fa-plus"></i>
      </button>
    </div>
    <div class="chat-history">
      <h3>
        <span>Chat History</span>
        <button id="filter-toggle" style="background: none; border: none; color: white; cursor: pointer;">
          <i class="fas fa-filter"></i>
        </button>
      </h3>
      <div class="filter-controls" id="filter-controls" style="display: none;">
        <select id="date-filter">
          <option value="all">All Dates</option>
          <option value="today">Today</option>
          <option value="week">This Week</option>
          <option value="month">This Month</option>
        </select>
        <select id="search-filter">
          <option value="">All Chats</option>
          <option value="travel">Travel</option>
          <option value="hotel">Hotel</option>
          <option value="flight">Flight</option>
        </select>
      </div>
      <ul id="chat-history-list"></ul>
    </div>
    <div class="sidebar-footer">
      <button onclick="deleteAllChats()">
        <i class="fas fa-trash"></i> Delete All Chats
      </button>
    </div>
  </div>

  <div class="main-chat-area">
    <header class="chat-header">
      <h1>Travel Assistant</h1>
      <p>Ask me anything about travel destinations, planning, or recommendations!</p>
    </header>

    <div class="chat-container" id="chat-container">
      <div class="chat-messages" id="chat-messages"></div>
      <div class="new-pill" id="new-pill">New messages â€¢ tap</div>

      <div class="chat-input-container">
        <div class="input-wrapper">
          <input type="text" id="user-input" placeholder="Ask about travel destinations, plans, or recommendations..." autocomplete="off"/>
          <button id="send-btn"><i class="fas fa-paper-plane"></i></button>
        </div>
        <div class="disclaimer">
          Travel Assistant may produce inaccurate information about people, places, or facts.
        </div>
      </div>
    </div>
  </div>

  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

  <script src="js/gemini.js"></script>
  <script src="js/script.js"></script>

  <script>
    (function () {
      const list   = document.getElementById('chat-messages');
      const pill   = document.getElementById('new-pill');

      function atBottom(el, slack = 40) {
        return el.scrollHeight - el.scrollTop - el.clientHeight <= slack;
      }
      function scrollToBottom(el) {
        el.scrollTop = el.scrollHeight;
      }

      // Show "new messages" pill only if user has scrolled up
      function onMutations() {
        if (atBottom(list)) {
          pill.style.display = 'none';
          scrollToBottom(list);
        } else {
          pill.style.display = 'inline-block';
        }
      }

      // Observe new messages regardless of how they're inserted
      const observer = new MutationObserver(onMutations);
      observer.observe(list, { childList: true });

      // Handle late-loading assets (e.g., images)
      list.addEventListener('load', (e) => {
        if (e.target.tagName === 'IMG' && atBottom(list)) scrollToBottom(list);
      }, true);

      // Click pill to jump down
      pill.addEventListener('click', () => {
        scrollToBottom(list);
        pill.style.display = 'none';
      });

      // Keep bottom on first paint & on resize
      window.addEventListener('load', () => scrollToBottom(list));
      window.addEventListener('resize', () => {
        if (atBottom(list)) scrollToBottom(list);
      });

      // Optional helpers you can call from your existing JS
      window.scrollChatToBottom = () => scrollToBottom(list);
      window.isChatAtBottom = () => atBottom(list);
    })();
  </script>
</body>
<script>
  // Enhanced functionality for delete buttons and filters
  document.addEventListener('DOMContentLoaded', function() {
    // Toggle filter controls
    document.getElementById('filter-toggle').addEventListener('click', function() {
      const filterControls = document.getElementById('filter-controls');
      filterControls.style.display = filterControls.style.display === 'none' ? 'flex' : 'none';
    });
    
    // Filter functionality
    document.getElementById('date-filter').addEventListener('change', applyFilters);
    document.getElementById('search-filter').addEventListener('change', applyFilters);
    
    function applyFilters() {
      const dateFilter = document.getElementById('date-filter').value;
      const searchFilter = document.getElementById('search-filter').value;
      
      // This would be implemented based on your actual chat data structure
      console.log('Applying filters:', dateFilter, searchFilter);
      // You would filter the chat history list based on these criteria
    }
    
    // Sample function to add a chat item with delete button
    function addChatToHistory(id, title) {
      const chatList = document.getElementById('chat-history-list');
      const li = document.createElement('li');
      li.innerHTML = `
        <div class="chat-item-content">${title}</div>
        <button class="delete-chat-btn" data-chat-id="${id}">
          <i class="fas fa-times"></i>
        </button>
      `;
      chatList.appendChild(li);
      
      // Add event listener to the delete button
      li.querySelector('.delete-chat-btn').addEventListener('click', function(e) {
        e.stopPropagation(); // Prevent triggering the chat selection
        const chatId = this.getAttribute('data-chat-id');
        deleteChat(chatId);
      });
    }
    
    // Function to delete a specific chat
    function deleteChat(chatId) {
      if (confirm('Are you sure you want to delete this chat?')) {
        console.log('Deleting chat:', chatId);
        // Implementation would depend on your data storage
        // Remove from UI
        const item = document.querySelector(`.delete-chat-btn[data-chat-id="${chatId}"]`).parentElement;
        item.remove();
      }
    }
    
    
    function deleteAllChats() {
      if (confirm('Are you sure you want to delete all chats? This action cannot be undone.')) {
        console.log('Deleting all chats');
        document.getElementById('chat-history-list').innerHTML = '';
      }
    }
    function applyFilters() {
    const dateFilter = document.getElementById('date-filter').value;
    const searchFilter = document.getElementById('search-filter').value;
    const items = document.querySelectorAll('#chat-history-list li');
  
    items.forEach(li => {
    const title = li.textContent.toLowerCase();
    let visible = true;

    if (searchFilter && !title.includes(searchFilter.toLowerCase())) {
      visible = false;
    }
    // Date filter logic would need timestamp metadata per chat
    li.style.display = visible ? '' : 'none';
  });
}

    
    // Expose these functions to the global scope
    function goBack() {
    window.history.back();
  }
    window.addChatToHistory = addChatToHistory;
    window.deleteChat = deleteChat;
    window.deleteAllChats = deleteAllChats;
    
    // Sample chat items for demonstration
    addChatToHistory('chat1', 'India travel plans');
    addChatToHistory('chat2', 'Hotel recommendations');
    addChatToHistory('chat3', 'Flight options');
  });
</script>
</html>